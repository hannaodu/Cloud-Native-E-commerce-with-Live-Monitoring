<!DOCTYPE html>
<html>
<head>
    <title>Our Serverless Ecommerce Store</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .products { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; }
        .product { border: 1px solid #ddd; padding: 15px; border-radius: 8px; }
        .product img { width: 100%; height: 200px; object-fit: cover; }
        button { background: #007bff; color: white; border: none; padding: 10px; border-radius: 4px; cursor: pointer; }
        .cart { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>üõçÔ∏è Our Serverless Ecommerce Store</h1>
    <p>Powered by AWS Lambda + API Gateway + DynamoDB</p>

    <div class="cart">
        <h2>üõí Shopping Cart</h2>
        <div id="cart-items">Cart is empty</div>
        <button onclick="createOrder()">Place Order</button>
    </div>

    <h2>üì¶ Products</h2>
    <div id="products" class="products">Loading...</div>

    <script>
    const API_URL = 'https://26y8cbhpua.execute-api.eu-west-2.amazonaws.com/prod';
    let cart = [];

    // Load products from YOUR API
    async function loadProducts() {
        try {
            const response = await fetch(`${API_URL}/products`);
            const data = await response.json();  // Changed this line
            displayProducts(data.products);      // And this line
        } catch (error) {
            console.error('Error loading products:', error);
            document.getElementById('products').innerHTML = 'Error loading products. Check console.';
        }
    }

    // Display products
    function displayProducts(products) {
        const container = document.getElementById('products');
        if (!products || products.length === 0) {
            container.innerHTML = '<p>No products found</p>';
            return;
        }
        
        container.innerHTML = products.map(product => `
            <div class="product">
                <img src="${product.image_url || 'https://via.placeholder.com/200'}" alt="${product.name}">
                <h3>${product.name}</h3>
                <p>$${product.price}</p>
                <p>${product.description}</p>
                <button onclick="addToCart('${product.product_id}', '${product.name}')">
                    Add to Cart
                </button>
            </div>
        `).join('');
    }

        // Add to cart
        function addToCart(productId, productName) {
            cart.push({ product_id: productId, name: productName });
            updateCartDisplay();
            
            // Call your actual API
            fetch(`${API_URL}/cart`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    user_id: 'demo-user-123',
                    product_id: productId,
                    quantity: 1
                })
            }).then(response => console.log('Added to cart via API'));
        }

        // Update cart display
        function updateCartDisplay() {
            const cartElement = document.getElementById('cart-items');
            if (cart.length === 0) {
                cartElement.innerHTML = 'Cart is empty';
            } else {
                cartElement.innerHTML = cart.map(item => 
                    `<div>${item.name}</div>`
                ).join('');
            }
        }

        // Create order using YOUR API
        async function createOrder() {
            if (cart.length === 0) return alert('Cart is empty!');
            
            try {
                const response = await fetch(`${API_URL}/orders`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: 'demo-user-123',
                        items: cart.map(item => ({ product_id: item.product_id, quantity: 1 }))
                    })
                });
                
                const order = await response.json();
                alert(`Order created! Order ID: ${order.order_id}`);
                cart = [];
                updateCartDisplay();
            } catch (error) {
                console.error('Error creating order:', error);
            }
        }

        // Load products when page loads
        loadProducts();
    </script>
</body>
</html>